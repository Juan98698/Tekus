@using Tekus.Frontend.Models
@using Tekus.Frontend.Services
@inject ProviderApiService Api
@using MudBlazor

<MudDialog>

    <DialogContent>
        <MudText Typo="Typo.h6">Servicios del proveedor</MudText>

        <MudTable Items="_services"
                  ServerData="LoadServerData"
                  RowsPerPage="_pageSize">

            <HeaderContent>
                <MudTh>Nombre</MudTh>
                <MudTh>Valor hora (USD)</MudTh>
                <MudTh>País(es)</MudTh>
           
            </HeaderContent>

            <RowTemplate>
                <MudTd>@context.Name</MudTd>
                <MudTd>@context.HourValueUsd</MudTd>

                <MudTd>
                    @if (context.Countries != null && context.Countries.Any())
                    {
                        @string.Join(", ", context.Countries.Select(c => c.Name))
                    }
                    else
                    {
                        <MudText Color="Color.Secondary" Typo="Typo.caption">
                            —
                        </MudText>
                    }
                </MudTd>

     
               
            </RowTemplate>

        </MudTable>
    </DialogContent>

    <DialogActions>        
        <MudButton Color="Color.Secondary" OnClick="Close">
            Cerrar
        </MudButton>
    </DialogActions>

</MudDialog>

@code {
    [CascadingParameter]
    public IMudDialogInstance MudDialog { get; set; } = default!;
    private void Cancel()
    {
        MudDialog.Cancel();
    }
    [Parameter]
    public Guid ProviderId { get; set; }

    private List<ServiceDto> _services = new();
    private int _pageSize = 10;

    private async Task<TableData<ServiceDto>> LoadServerData(TableState state, CancellationToken token)
    {
        var page = state.Page + 1;

        var result = await Api.GetServicesByProviderAsync(
            ProviderId,
            page,
            state.PageSize
        );
  

        return new TableData<ServiceDto>
        {
            Items = result.Items,
            TotalItems = result.TotalCount
        };
    }
   
    private void Close()
    {
        MudDialog.Cancel();
    }
}