@using Tekus.Frontend.Models
@using Tekus.Frontend.Services
@inject ProviderApiService Api

<MudDialog>

    <DialogContent>
        <MudText Typo="Typo.h6">Servicios del proveedor</MudText>

        <MudTable T="ServiceDto"
                  ServerData="LoadServerData"
                  RowsPerPage="_pageSize">

            <HeaderContent>
                <MudTh>Nombre</MudTh>
                <MudTh>Valor hora (USD)</MudTh>
                <MudTh>País(es)</MudTh>
            </HeaderContent>

            <RowTemplate>
                <MudTd>@context.Name</MudTd>
                <MudTd>@context.HourValueUsd</MudTd>
                <MudTd>
                    @string.Join(", ", context.Countries.Select(c => c.Name))
                </MudTd>
            </RowTemplate>

        </MudTable>
    </DialogContent>

    <DialogActions>
        <MudButton Color="Color.Secondary" OnClick="Cancel">
            Cerrar
        </MudButton>
    </DialogActions>
</MudDialog>


@code {
    [CascadingParameter]
    public IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public Guid ProviderId { get; set; }

    private int _pageSize = 10;

    private async Task<TableData<ServiceDto>> LoadServerData(
        TableState state,
        CancellationToken token)
    {
        var page = state.Page + 1;
        var result = await Api.GetServicesByProviderAsync(
            ProviderId, page, state.PageSize);

        return new TableData<ServiceDto>
        {
            Items = result.Items,
            TotalItems = result.TotalCount
        };
    }

    private void Cancel()
    {
        Console.WriteLine($"Dialog instance: {MudDialog}");
        MudDialog?.Cancel();
    }
}