@using Tekus.Frontend.Models
@using Tekus.Frontend.Services
@page "/providers"
@inject ProviderApiService Api
@inject IDialogService DialogService

<MudText Typo="Typo.h4">Providers</MudText>

<MudButton Color="Color.Primary" OnClick="OpenCreateDialog">
    Create Provider
</MudButton>

<MudTable Items="_providers">
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>NIT</MudTh>
        <MudTh>Email</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.Name</MudTd>
        <MudTd>@context.Nit</MudTd>
        <MudTd>@context.Email</MudTd>
    </RowTemplate>
</MudTable>

@code {
    private List<ProviderDto> _providers = [];

    protected override async Task OnInitializedAsync()
    {
        await LoadProviders();
    }


    private async Task LoadProviders()
    {
        var result = await Api.GetProvidersAsync();
        _providers = result.Items;
    }


    private async Task OpenCreateDialog()
    {
        var dialog = await DialogService.ShowAsync<CreateProviderDialog>("Create Provider");
        var result = await dialog.Result;

        if (!result.Canceled)
            await LoadProviders();
    }
}